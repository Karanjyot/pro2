
var socket=io.connect("http://localhost:8080"),message=document.getElementById("message"),handle=document.getElementById("handle"),send=document.getElementById("send"),output=document.getElementById("output"),feedback=document.getElementById("feedback"),to=document.getElementById("to"),save=document.getElementById("save"),chat=document.getElementById("chat"),buttons=document.getElementsByClassName("buttons"),body=document.getElementById("balls"),testArr=[],senderArr=[];window.onload=()=>{$.get({type:"POST",url:"/api/user"}).then(function(a){console.log(a),senderArr.push(a);var b=senderArr[0];socket.emit("add-user",{username:b})}).fail(function(a){console.log(a)})},document.querySelector("#message").addEventListener("keypress",function(a){if("Enter"===a.key){event.preventDefault(),socket.emit("chat",{message:message.value,handle:senderArr[0]}),socket.emit("private-message",{message:message.value,handle:senderArr[0],to:testArr[0]});var b={sender:senderArr[0],reciever:testArr[0],chat:message.value};$.ajax({type:"POST",url:"/api/post",data:b})}}),message.addEventListener("keypress",()=>{socket.emit("typing",{sender:senderArr,reciever:testArr[0]})}),chat.addEventListener("click",a=>{a.preventDefault(),$.ajax({type:"POST",url:"/api/users",success:function(a){console.log(a);for(var b,c=JSON.parse(a),d=0;d<c.length;d++)b=document.createElement("BUTTON"),b.innerHTML=c[d],$("#conversation-list").append(b),b.className="buttons",b.onclick=function(){var a=senderArr[0];socket.emit("add-user",{username:a});var b={reciever:this.innerHTML,sender:senderArr[0]};testArr=[this.innerHTML],console.log(testArr),$("#firstName").text(testArr[0]),$.ajax({type:"POST",url:"/api/chats",data:b,success:function(a){var b=JSON.parse(a);console.log(b),$(".chats").remove();for(var c,d=0;d<b.length;d++)c=document.createElement("LI"),c.innerHTML=b[d].sender+" says: "+b[d].chats,c.className="chats",$("#ulChats").append(c),c.className=b[d].sender===senderArr[0]?"sender":"reciever"}})}}})}),socket.on("chat",a=>{feedback.innerHTML="",output.innerHTML+=`<p><strong> ${a.handle} </strong> ${a.message} </p>`}),socket.on("private-message",a=>{feedback.innerHTML="",a.handle===senderArr[0]?$("#ulChats").append(`<li class="sender">${a.handle} says: ${a.message}</li>`):$("#ulChats").append(`<li class="reciever">${a.handle} says: ${a.message}</li>`)}),socket.on("typing",a=>{feedback.innerHTML=`<p><em> ${a.sender} is typing a message...</em></p>`});